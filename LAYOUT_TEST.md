# 拖拽布局功能测试指南

## 快速测试步骤

### 1. 启动开发服务器

```bash
npm run dev
```

浏览器会自动打开 `http://localhost:5173`

### 2. 测试拖拽功能

1. **找到拖拽手柄**
   - 每个面板左上角有一个四点图标（⋮⋮）
   - 鼠标悬停时会高亮显示

2. **拖动面板**
   - 点击并按住拖拽手柄
   - 移动鼠标，面板会跟随移动
   - 松开鼠标，面板会自动对齐到网格

3. **验证保存**
   - 刷新页面（F5）
   - 检查面板是否保持在新位置
   - 如果位置保持不变，说明 localStorage 保存成功！

### 3. 测试调整大小功能

1. **找到调整大小手柄**
   - 每个面板右下角有一个三角图标
   - 鼠标悬停时会高亮显示

2. **调整面板大小**
   - 点击并按住调整大小手柄
   - 向右下拖动以增大面板
   - 向左上拖动以缩小面板
   - 松开鼠标，面板大小会自动对齐到网格

3. **验证保存**
   - 刷新页面（F5）
   - 检查面板大小是否保持不变

### 4. 测试多用户场景

1. **浏览器 A（Chrome）**
   - 打开应用
   - 拖动一些面板到新位置
   - 记住布局

2. **浏览器 B（Firefox 或 Edge）**
   - 打开应用
   - 检查是否显示默认布局（而不是浏览器 A 的布局）
   - 拖动面板到不同位置

3. **返回浏览器 A**
   - 刷新页面
   - 确认布局仍然是之前设置的（没有被浏览器 B 影响）

### 5. 测试重置功能

1. **打开设置**
   - 点击右上角的设置图标

2. **重置布局**
   - 滚动到"仪表板"部分
   - 点击"重置面板布局"按钮
   - 确认弹窗

3. **验证重置**
   - 所有面板应该恢复到默认位置和大小
   - 刷新页面，确认布局保持默认状态

### 6. 检查 localStorage

在浏览器开发者工具中：

1. 按 F12 打开开发者工具
2. 切换到 "Application" 或 "存储" 标签页
3. 展开 "Local Storage" → `http://localhost:5173`
4. 找到 `situation_monitor_layout_v1` 键
5. 查看其值（应该是 JSON 格式的布局数据）

**示例数据**：
```json
{
  "usdjpy": {"id":"usdjpy","x":0,"y":0,"w":3,"h":2},
  "map": {"id":"map","x":0,"y":2,"w":12,"h":4},
  "politics": {"id":"politics","x":0,"y":6,"w":3,"h":3}
}
```

### 7. 测试边界情况

1. **拖到边界外**
   - 尝试将面板拖到网格左侧或顶部之外
   - 面板应该自动限制在网格内（x >= 0, y >= 0）

2. **超大面板**
   - 尝试将面板调整到非常大
   - 面板宽度应该不超过 12 列

3. **超小面板**
   - 尝试将面板调整到非常小
   - 面板应该有最小尺寸限制（w >= 2, h >= 2）

### 8. 性能测试

1. **快速拖拽**
   - 快速连续拖动多个面板
   - 检查是否有卡顿或延迟

2. **防抖验证**
   - 拖动一个面板
   - 在拖动过程中，打开浏览器开发者工具的 Console
   - 应该看到 "[Layout] 布局已保存到 localStorage" 只在拖拽结束后出现一次
   - 而不是拖动过程中频繁出现

### 9. 控制台日志

正常运行时，控制台应该显示：

```
[Layout] 从 localStorage 加载布局: 26 个面板
[Dashboard] 布局已初始化
[Layout] 布局已保存到 localStorage  // 拖拽/调整大小后
```

如果显示警告或错误，请检查代码实现。

## 已知问题和限制

1. **不支持跨设备同步**
   - localStorage 是浏览器本地存储
   - 不会自动同步到其他设备或浏览器

2. **不支持撤销/重做**
   - 当前版本不支持撤销操作
   - 如果拖错了，需要手动拖回或重置布局

3. **面板可能重叠**
   - 当前版本没有碰撞检测
   - 用户可以将面板拖到重叠位置（这是设计上的选择，允许用户自由布局）

4. **移动端支持有限**
   - 拖拽功能主要为桌面端设计
   - 移动端可能需要调整触摸事件处理

## 浏览器兼容性

测试过的浏览器：
- ✅ Chrome 120+
- ✅ Firefox 120+
- ✅ Edge 120+
- ✅ Safari 17+
- ⚠️ IE 11（不支持，项目使用现代 JavaScript）

## 报告问题

如果发现以下情况，请报告：

1. 拖拽后刷新页面，布局没有保存
2. 拖拽过程中页面卡顿严重
3. 面板拖到屏幕外无法找回
4. 控制台出现错误信息
5. localStorage 数据格式异常

## 调试技巧

### 查看当前布局状态

在浏览器控制台中运行：

```javascript
// 读取 localStorage
const layout = localStorage.getItem('situation_monitor_layout_v1');
console.log(JSON.parse(layout));
```

### 手动设置布局

```javascript
// 设置自定义布局
const customLayout = {
  usdjpy: { id: 'usdjpy', x: 0, y: 0, w: 3, h: 2 },
  politics: { id: 'politics', x: 3, y: 0, w: 3, h: 3 }
};
localStorage.setItem('situation_monitor_layout_v1', JSON.stringify(customLayout));
location.reload(); // 刷新页面应用布局
```

### 清除布局数据

```javascript
// 删除布局数据，下次加载时使用默认布局
localStorage.removeItem('situation_monitor_layout_v1');
location.reload();
```

## 成功标准

测试通过的标准：

- ✅ 可以拖动面板到任意位置
- ✅ 可以调整面板大小
- ✅ 刷新页面后布局保持不变
- ✅ 不同浏览器的布局互不影响
- ✅ 可以通过设置重置布局
- ✅ localStorage 中有正确的 JSON 数据
- ✅ 控制台没有错误信息
- ✅ 拖拽流畅，没有明显卡顿

---

**测试版本**: v1.0  
**测试日期**: 2026-01-29  
**预计测试时间**: 15-20 分钟
