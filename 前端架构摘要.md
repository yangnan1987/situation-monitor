# Situation Monitor - å‰ç«¯æ¶æ„æ‘˜è¦

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: Situation Monitor  
**æŠ€æœ¯æ ˆ**: SvelteKit 2.0 + Svelte 5 + TypeScript + Tailwind CSS  
**éƒ¨ç½²æ–¹å¼**: é™æ€ç«™ç‚¹ï¼ˆStatic Site Generationï¼‰  
**æ„å»ºå·¥å…·**: Vite 6.0

---

## ğŸ§© ç»„ä»¶ç»“æ„

### æ ¸å¿ƒç»„ä»¶å±‚çº§

```
src/lib/components/
â”œâ”€â”€ common/              # é€šç”¨ç»„ä»¶
â”‚   â”œâ”€â”€ NewsItem.svelte  # â­ æ–°é—»å¡ç‰‡æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ Panel.svelte     # é¢æ¿å®¹å™¨ç»„ä»¶
â”‚   â”œâ”€â”€ MarketItem.svelte
â”‚   â”œâ”€â”€ LoadingSpinner.svelte
â”‚   â””â”€â”€ ErrorMessage.svelte
â”‚
â”œâ”€â”€ panels/              # é¢æ¿ç»„ä»¶
â”‚   â”œâ”€â”€ NewsPanel.svelte # â­ æ–°é—»é¢æ¿ï¼ˆä½¿ç”¨ NewsItemï¼‰
â”‚   â”œâ”€â”€ MarketsPanel.svelte
â”‚   â”œâ”€â”€ CryptoPanel.svelte
â”‚   â””â”€â”€ ... (20+ ä¸ªé¢æ¿)
â”‚
â”œâ”€â”€ layout/              # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ Dashboard.svelte
â”‚   â””â”€â”€ Header.svelte
â”‚
â””â”€â”€ modals/              # æ¨¡æ€æ¡†ç»„ä»¶
    â”œâ”€â”€ SettingsModal.svelte
    â”œâ”€â”€ MonitorFormModal.svelte
    â””â”€â”€ OnboardingModal.svelte
```

### æ–°é—»å¡ç‰‡æ ¸å¿ƒç»„ä»¶ä½ç½®

#### 1. **æ–°é—»å¡ç‰‡ç»„ä»¶** - `src/lib/components/common/NewsItem.svelte`

**æ–‡ä»¶è·¯å¾„**: `src/lib/components/common/NewsItem.svelte`

**åŠŸèƒ½**: å•ä¸ªæ–°é—»æ¡ç›®çš„å±•ç¤ºç»„ä»¶

**Props æ¥å£**:
```typescript
interface Props {
  item: NewsItem;              // æ–°é—»æ•°æ®å¯¹è±¡
  showSource?: boolean;         // æ˜¯å¦æ˜¾ç¤ºæ¥æºï¼ˆé»˜è®¤: trueï¼‰
  showAlert?: boolean;          // æ˜¯å¦æ˜¾ç¤ºè­¦æŠ¥æ ‡ç­¾ï¼ˆé»˜è®¤: trueï¼‰
  showDescription?: boolean;    // æ˜¯å¦æ˜¾ç¤ºæè¿°ï¼ˆé»˜è®¤: falseï¼‰
  compact?: boolean;            // ç´§å‡‘æ¨¡å¼ï¼ˆé»˜è®¤: falseï¼‰
}
```

**å…³é”®ä»£ç ç‰‡æ®µ**:
```svelte
<div class="news-item" class:alert={showAlert && item.isAlert} class:compact>
  {#if showSource}
    <div class="item-source">
      {item.source}
      {#if showAlert && item.isAlert}
        <span class="alert-tag">ALERT</span>
      {/if}
    </div>
  {/if}

  <a class="item-title" href={item.link} target="_blank" rel="noopener noreferrer">
    {item.title}
  </a>

  {#if showDescription && item.description}
    <p class="item-description">{item.description}</p>
  {/if}

  <div class="item-meta">
    <span class="item-time">{timeAgo(item.timestamp)}</span>
    {#if item.region}
      <span class="item-region">{item.region}</span>
    {/if}
  </div>
</div>
```

**æ·»åŠ æŒ‰é’®å»ºè®®ä½ç½®**: 
- åœ¨ `<div class="item-meta">` å†…éƒ¨æ·»åŠ æ“ä½œæŒ‰é’®
- æˆ–åœ¨ `<a class="item-title">` ä¸‹æ–¹æ·»åŠ æŒ‰é’®ç»„
- å»ºè®®ä½¿ç”¨ `item-actions` ç±»ååˆ›å»ºæ–°çš„æŒ‰é’®å®¹å™¨

#### 2. **æ–°é—»é¢æ¿ç»„ä»¶** - `src/lib/components/panels/NewsPanel.svelte`

**æ–‡ä»¶è·¯å¾„**: `src/lib/components/panels/NewsPanel.svelte`

**åŠŸèƒ½**: æ–°é—»åˆ†ç±»é¢æ¿ï¼ŒåŒ…å«å¤šä¸ª NewsItem ç»„ä»¶

**å…³é”®ä»£ç ç‰‡æ®µ**:
```svelte
<Panel id={panelId} {title} {count} {loading} {error}>
  {#if items.length === 0 && !loading && !error}
    <div class="empty-state">æš‚æ— æ–°é—»</div>
  {:else}
    <div class="news-list">
      {#each items.slice(0, 15) as item (item.id)}
        <NewsItem {item} />
      {/each}
    </div>
  {/if}
</Panel>
```

**æ·»åŠ æŒ‰é’®å»ºè®®ä½ç½®**:
- åœ¨ `<Panel>` ç»„ä»¶å†…æ·»åŠ é¢æ¿çº§åˆ«çš„æ“ä½œæŒ‰é’®ï¼ˆå¦‚"åˆ·æ–°"ã€"ç­›é€‰"ï¼‰
- åœ¨ `<NewsItem>` ç»„ä»¶å†…æ·»åŠ æ¯ä¸ªæ–°é—»æ¡ç›®çš„æ“ä½œæŒ‰é’®ï¼ˆå¦‚"æ”¶è—"ã€"åˆ†äº«"ï¼‰

#### 3. **ä¸»é¡µé¢** - `src/routes/+page.svelte`

**æ–‡ä»¶è·¯å¾„**: `src/routes/+page.svelte`

**åŠŸèƒ½**: åº”ç”¨ä¸»å…¥å£ï¼ŒåŒ…å«æ‰€æœ‰é¢æ¿å’Œæ•°æ®åŠ è½½é€»è¾‘

**å…³é”®æ•°æ®åŠ è½½å‡½æ•°**:
```typescript
async function loadNews() {
  const categories = ['politics', 'tech', 'finance', 'gov', 'ai', 'intel'] as const;
  categories.forEach((cat) => news.setLoading(cat, true));

  try {
    const data = await fetchAllNews();
    Object.entries(data).forEach(([category, items]) => {
      news.setItems(category as keyof typeof data, items);
    });
  } catch (error) {
    categories.forEach((cat) => news.setError(cat, String(error)));
  }
}
```

---

## ğŸ“Š æ•°æ®å®šä¹‰

### NewsItem æ¥å£å®šä¹‰

**æ–‡ä»¶è·¯å¾„**: `src/lib/types/index.ts` (ç¬¬ 11-25 è¡Œ)

```typescript
export interface NewsItem {
  // åŸºç¡€æ ‡è¯†
  id: string;                    // å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆæ ¼å¼: "gdelt-{category}-{urlHash}-{index}"ï¼‰
  title: string;                 // æ–°é—»æ ‡é¢˜
  link: string;                  // æ–°é—»é“¾æ¥ URL
  source: string;                // æ–°é—»æ¥æºï¼ˆå¦‚ "BBC World", "NYT World"ï¼‰
  category: NewsCategory;        // åˆ†ç±»: 'politics' | 'tech' | 'finance' | 'gov' | 'ai' | 'intel'

  // æ—¶é—´ä¿¡æ¯
  pubDate?: string;              // åŸå§‹å‘å¸ƒæ—¥æœŸå­—ç¬¦ä¸²ï¼ˆGDELT æ ¼å¼: "20251202T224500Z"ï¼‰
  timestamp: number;             // Unix æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰

  // å†…å®¹ä¿¡æ¯
  description?: string;          // æ–°é—»æè¿°ï¼ˆå¯é€‰ï¼‰
  content?: string;              // æ–°é—»æ­£æ–‡å†…å®¹ï¼ˆå¯é€‰ï¼‰

  // åˆ†ææ ‡ç­¾
  isAlert?: boolean;              // æ˜¯å¦åŒ…å«è­¦æŠ¥å…³é”®è¯
  alertKeyword?: string;          // è§¦å‘çš„è­¦æŠ¥å…³é”®è¯
  region?: string;               // æ£€æµ‹åˆ°çš„åœ°åŒºï¼ˆå¦‚ "US", "CN", "EU"ï¼‰
  topics?: string[];             // æ£€æµ‹åˆ°çš„ä¸»é¢˜æ ‡ç­¾æ•°ç»„
}
```

### NewsCategory ç±»å‹å®šä¹‰

```typescript
export type NewsCategory = 'politics' | 'tech' | 'finance' | 'gov' | 'ai' | 'intel';
```

### ç›¸å…³æ•°æ®ç»“æ„

**æ–°é—»çŠ¶æ€ç®¡ç†** (`src/lib/stores/news.ts`):
```typescript
export interface CategoryState {
  items: NewsItem[];             // è¯¥åˆ†ç±»çš„æ–°é—»åˆ—è¡¨
  loading: boolean;              // åŠ è½½çŠ¶æ€
  error: string | null;         // é”™è¯¯ä¿¡æ¯
  lastUpdated: number | null;    // æœ€åæ›´æ–°æ—¶é—´æˆ³
}

export interface NewsState {
  categories: Record<NewsCategory, CategoryState>;
  initialized: boolean;
}
```

---

## ğŸ”§ æœåŠ¡ç«¯èƒ½åŠ›

### å½“å‰æ¶æ„ï¼šçº¯é™æ€ç«™ç‚¹ï¼ˆæ— æœåŠ¡ç«¯ï¼‰

**å…³é”®é…ç½®**: `src/routes/+layout.ts`
```typescript
export const prerender = true;  // å¯ç”¨é¢„æ¸²æŸ“
export const ssr = false;        // ç¦ç”¨æœåŠ¡ç«¯æ¸²æŸ“
```

### æ•°æ®è·å–æ–¹å¼

**æ‰€æœ‰æ•°æ®è·å–å‡åœ¨å®¢æˆ·ç«¯å®Œæˆ**ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼ï¼š

1. **ç›´æ¥ API è°ƒç”¨** (æµè§ˆå™¨ç«¯)
   - GDELT API: `https://api.gdeltproject.org/api/v2/doc/doc`
   - CoinGecko API: `https://api.coingecko.com`
   - FRED API: `https://api.stlouisfed.org/fred`
   - å…¶ä»–å…¬å¼€ API

2. **CORS ä»£ç†** (è§£å†³è·¨åŸŸé—®é¢˜)
   - ä¸»ä»£ç†: `https://situation-monitor-proxy.seanthielen-e.workers.dev/?url=`
   - å¤‡ç”¨ä»£ç†: `https://corsproxy.io/?url=`

3. **æ•°æ®è·å–ä½ç½®**
   - **API å‡½æ•°**: `src/lib/api/` ç›®å½•
   - **æœåŠ¡å±‚**: `src/lib/services/client.ts` (åŒ…å«ç¼“å­˜ã€ç†”æ–­å™¨ã€é‡è¯•æœºåˆ¶)
   - **æ•°æ®å­˜å‚¨**: `src/lib/stores/` ç›®å½• (Svelte stores)

### åç«¯é€»è¾‘å¤„ç†å†…å®¹

**å½“å‰æ— ä¼ ç»Ÿåç«¯æœåŠ¡**ï¼Œæ‰€æœ‰é€»è¾‘åœ¨å®¢æˆ·ç«¯å¤„ç†ï¼š

1. **æ•°æ®è·å–ä¸ç¼“å­˜**
   - é€šè¿‡ `ServiceClient` ç»Ÿä¸€ç®¡ç† HTTP è¯·æ±‚
   - å†…å­˜ç¼“å­˜ + IndexedDB æŒä¹…åŒ–ç¼“å­˜
   - ç¼“å­˜ TTL: æ–°é—» 3 åˆ†é’Ÿï¼Œå¸‚åœºæ•°æ® 1 åˆ†é’Ÿ

2. **é”™è¯¯å¤„ç†ä¸é‡è¯•**
   - ç†”æ–­å™¨æ¨¡å¼ï¼ˆCircuit Breakerï¼‰
   - æŒ‡æ•°é€€é¿é‡è¯•æœºåˆ¶
   - è¯·æ±‚å»é‡ï¼ˆé˜²æ­¢å¹¶å‘é‡å¤è¯·æ±‚ï¼‰

3. **æ•°æ®åˆ†æå¤„ç†**ï¼ˆå®¢æˆ·ç«¯ï¼‰
   - å…³é”®è¯æ£€æµ‹ (`src/lib/config/keywords.ts`)
   - åœ°åŒºè¯†åˆ«
   - ä¸»é¢˜åˆ†ç±»
   - ç›¸å…³æ€§åˆ†æ (`src/lib/analysis/correlation.ts`)
   - å™äº‹è¿½è¸ª (`src/lib/analysis/narrative.ts`)

### å¦‚éœ€æ·»åŠ æœåŠ¡ç«¯ API

**å»ºè®®æ–¹æ¡ˆ**:
1. åˆ›å»º `src/routes/api/` ç›®å½•
2. æ·»åŠ  `+server.ts` æ–‡ä»¶ï¼ˆSvelteKit API è·¯ç”±ï¼‰
3. ä¿®æ”¹ `+layout.ts` å¯ç”¨ SSRï¼ˆå¦‚éœ€è¦ï¼‰

**ç¤ºä¾‹ç»“æ„**:
```
src/routes/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ news/
â”‚   â”‚   â””â”€â”€ +server.ts      # GET /api/news
â”‚   â””â”€â”€ markets/
â”‚       â””â”€â”€ +server.ts      # GET /api/markets
```

---

## ğŸš€ éƒ¨ç½²é…ç½®

### Vercel é…ç½®

**æ–‡ä»¶è·¯å¾„**: `vercel.json`

```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "build",
  "framework": "sveltekit"
}
```

**éƒ¨ç½²ç¯å¢ƒ**: Vercelï¼ˆé™æ€ç«™ç‚¹æ‰˜ç®¡ï¼‰

### SvelteKit é…ç½®

**æ–‡ä»¶è·¯å¾„**: `svelte.config.js`

```javascript
import adapter from '@sveltejs/adapter-static';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

const config = {
  preprocess: vitePreprocess(),
  kit: {
    // é™æ€é€‚é…å™¨ - ç”Ÿæˆçº¯é™æ€ HTML/CSS/JS
    adapter: adapter({
      pages: 'build',
      assets: 'build',
      fallback: 'app.html',
      precompress: false,
      strict: true
    }),
    paths: {
      base: process.env.BASE_PATH || ''  // æ”¯æŒå­è·¯å¾„éƒ¨ç½²
    },
    alias: {
      $lib: 'src/lib',
      $components: 'src/lib/components',
      $stores: 'src/lib/stores',
      $services: 'src/lib/services',
      $config: 'src/lib/config',
      $types: 'src/lib/types'
    }
  }
};
```

**å…³é”®é…ç½®è¯´æ˜**:
- **é€‚é…å™¨**: `@sveltejs/adapter-static` - ç”Ÿæˆé™æ€æ–‡ä»¶
- **è¾“å‡ºç›®å½•**: `build/`
- **è·¯å¾„åˆ«å**: æ”¯æŒ `$lib`, `$components` ç­‰å¿«æ·å¯¼å…¥
- **BASE_PATH**: æ”¯æŒå­è·¯å¾„éƒ¨ç½²ï¼ˆå¦‚ GitHub Pages: `/situation-monitor`ï¼‰

### GitHub Actions éƒ¨ç½²

**æ–‡ä»¶è·¯å¾„**: `.github/workflows/deploy.yml`

æ ¹æ®é¡¹ç›®ç»“æ„ï¼Œåº”é…ç½®ä¸ºï¼š
- æ„å»ºå‘½ä»¤: `npm run build`
- è¾“å‡ºç›®å½•: `build/`
- éƒ¨ç½²ç›®æ ‡: GitHub Pagesï¼ˆè·¯å¾„: `/situation-monitor`ï¼‰

### ç¯å¢ƒå˜é‡

**éœ€è¦é…ç½®çš„ç¯å¢ƒå˜é‡**ï¼ˆé€šè¿‡ Vercel æˆ– `.env`ï¼‰:
```bash
VITE_FINNHUB_API_KEY=xxx      # Finnhub API å¯†é’¥ï¼ˆå¸‚åœºæ•°æ®ï¼‰
VITE_FRED_API_KEY=xxx         # FRED API å¯†é’¥ï¼ˆç»æµæ•°æ®ï¼‰
BASE_PATH=/situation-monitor   # éƒ¨ç½²åŸºç¡€è·¯å¾„ï¼ˆGitHub Pagesï¼‰
```

---

## ğŸ“ æ·»åŠ æŒ‰é’®çš„å»ºè®®ä½ç½®

### æ–¹æ¡ˆ 1: åœ¨ NewsItem ç»„ä»¶å†…æ·»åŠ æ“ä½œæŒ‰é’®

**ä¿®æ”¹æ–‡ä»¶**: `src/lib/components/common/NewsItem.svelte`

```svelte
<div class="item-meta">
  <span class="item-time">{timeAgo(item.timestamp)}</span>
  {#if item.region}
    <span class="item-region">{item.region}</span>
  {/if}
  
  <!-- æ·»åŠ æŒ‰é’®ç»„ -->
  <div class="item-actions">
    <button class="btn-icon" on:click={() => handleFavorite(item)}>
      â­
    </button>
    <button class="btn-icon" on:click={() => handleShare(item)}>
      ğŸ”—
    </button>
  </div>
</div>
```

### æ–¹æ¡ˆ 2: åœ¨ NewsPanel ç»„ä»¶å†…æ·»åŠ é¢æ¿çº§æŒ‰é’®

**ä¿®æ”¹æ–‡ä»¶**: `src/lib/components/panels/NewsPanel.svelte`

```svelte
<Panel id={panelId} {title} {count} {loading} {error}>
  <!-- æ·»åŠ é¢æ¿æ“ä½œæ  -->
  <div class="panel-actions">
    <button on:click={handleRefresh}>åˆ·æ–°</button>
    <button on:click={handleFilter}>ç­›é€‰</button>
  </div>
  
  <div class="news-list">
    {#each items.slice(0, 15) as item (item.id)}
      <NewsItem {item} />
    {/each}
  </div>
</Panel>
```

---

## ğŸ”— å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” |
|---------|------|
| `src/lib/components/common/NewsItem.svelte` | â­ æ–°é—»å¡ç‰‡ç»„ä»¶ï¼ˆæ·»åŠ æŒ‰é’®çš„ä¸»è¦ä½ç½®ï¼‰ |
| `src/lib/components/panels/NewsPanel.svelte` | æ–°é—»é¢æ¿å®¹å™¨ |
| `src/lib/types/index.ts` | TypeScript ç±»å‹å®šä¹‰ï¼ˆåŒ…å« NewsItemï¼‰ |
| `src/lib/stores/news.ts` | æ–°é—»æ•°æ®çŠ¶æ€ç®¡ç† |
| `src/lib/api/news.ts` | æ–°é—»æ•°æ®è·å–é€»è¾‘ |
| `src/routes/+page.svelte` | ä¸»é¡µé¢å…¥å£ |
| `svelte.config.js` | SvelteKit æ„å»ºé…ç½® |
| `vercel.json` | Vercel éƒ¨ç½²é…ç½® |

---

## ğŸ“Œ æ€»ç»“

- **ç»„ä»¶ç»“æ„**: æ–°é—»å¡ç‰‡åœ¨ `NewsItem.svelte`ï¼Œé¢æ¿åœ¨ `NewsPanel.svelte`
- **æ•°æ®å®šä¹‰**: `NewsItem` æ¥å£åŒ…å« 15+ å­—æ®µï¼Œæ”¯æŒæ ‡é¢˜ã€é“¾æ¥ã€æ—¶é—´ã€æ ‡ç­¾ç­‰
- **æœåŠ¡ç«¯**: å½“å‰ä¸ºçº¯é™æ€ç«™ç‚¹ï¼Œæ‰€æœ‰é€»è¾‘åœ¨å®¢æˆ·ç«¯å¤„ç†
- **éƒ¨ç½²**: ä½¿ç”¨ Vercel æˆ– GitHub Pagesï¼Œé…ç½®ä¸ºé™æ€ç«™ç‚¹ç”Ÿæˆ

**æ·»åŠ æŒ‰é’®çš„æœ€ä½³ä½ç½®**: `src/lib/components/common/NewsItem.svelte` çš„ `item-meta` åŒºåŸŸ
